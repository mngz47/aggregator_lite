<html>
<head>
<title>Aggregator Lite</title>
</head>
<body>
<script src=api.js ></script>
<script src=product.js ></script>
<h3>Target Website</h3>
<span>URL</span>
<input type=text name=url id=url />
<a href=# onclick="getUrlText(e('url').value);e('log').innerHTML='';" >START</a>
<br><br>
<strong>LOG</strong>
<div style="border:2px solid red;padding:10px;"  id=log ></div>
<script>
var external_urls = [];

var layer_urls = [];

function layerURL(text){

var links = text.split('<a ');

e('log').innerHTML += '('+links.length+') links<br>';

for(var a=0;a<links.length;a++){

var narrow = links[a].substring(0,400);

var hh = narrow.substring(narrow.indexOf('href="')+6,narrow.indexOf('" '));
 e('log').innerHTML += '('+hh+') link<br>';
   
if(hh.includes(e('url').value)){
layer_urls[layer_urls.length] = hh;
}else if(!hh.includes('https://')){
layer_urls[layer_urls.length] = e('url').value+hh;
}else{
external_urls[external_urls.length] = hh;
}
}

}

function getUrlText(url){
var text; 

var f = new FormData();
f.append('URL',url);

var res = sendform_2('feature/aggregation/lite/gettext.php',f);
res.onload = function(){
text = res.responseText;

layerURL(text);

for(var a=0;a<layer_urls.length;a++){

   getUrlText(layer_urls[a]);
   
   fetch_product(layer_urls[a],text);
}
};

return text;
}

</script>
</body>
</html>
