<html>
<head>
<title>Aggregator Lite</title>
</head>
<body>
<script src=api.js ></script>
<script src=product.js ></script>
<h3>Target Website</h3>
<span>URL</span>
<input type=text name=url id=url />
<a href=# onclick="getUrlText(e('url').value);e('log').innerHTML='';" >START</a>
<a href=# onclick="stop=true;" >STOP</a>
<br><br>
<strong>LOG</strong>
<div style="border:2px solid red;padding:10px;"  id=log ></div>
<script>
var external_urls = [];

var layer_urls = [];

function layerURL(text){

var links = text.split('<a ');

for(var a=0;a<links.length;a++){

var narrow = links[a].substring(0,400);

var hh = narrow.substring(narrow.indexOf('href="')+6,narrow.indexOf('" '));
 e('log').innerHTML += '('+hh+') link<br>';
   
if(hh.includes(e('url').value)){
layer_urls[layer_urls.length] = hh;
}else if(hh.substring(0)=='\/'){
layer_urls[layer_urls.length] = e('url').value+hh; 
}else{
external_urls[external_urls.length] = hh;
}
}

}

 var stop = false;
 var ind = 0;
 
async function getUrlText(url){

var f = new FormData();
f.append('URL',url);

var res = sendform_2('feature/aggregation/lite/gettext.php',f);
res.onload = function(){
var text = res.responseText;
  
 layerURL(text);
 
 e('log').innerHTML += '('+ind+') index<br>';
 
 e('log').innerHTML += '('+layer_urls.length+') links<br>';
 
 e('log').innerHTML += '('+external_urls.length+') exit links<br>';
 
if(!stop && ind<layer_urls.length){

 fetch_product(layer_urls[ind],text);
 ind+=1;
 
 getUrlText(layer_urls[ind]);
 
   }
};
}

</script>
</body>
</html>
