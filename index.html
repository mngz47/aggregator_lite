<html>
<head>
<title>Aggregator Lite</title>
</head>
<body>
<script src=api.js ></script>
<script src=product.js ></script>
<h3>Target Website</h3>
<span>URL</span>
<input type=text name=url id=url />
<a href=# onclick="getUrlText(e('url').value);" >START</a>
<div id=log ></div>
<script>
var external_urls = [];

var layer_urls = [];

function layerURL(text){

var links = text.split('<a ');

e('log').innerHTML += '('+links.length+') links<br>';

for(var a=0;a<links.length;a++){

var hh = links[a].substring(indexOf('href="'),indexOf('" '));
if(hh.contains(e('url').value)){
layer_urls[layer_urls.length] = hh;
}else{
external_urls[external_urls.length] = hh;
}
}
}

async function getUrlText(url){
var text; 

var f = new FormData();
f.append('URL',url);

var res = sendform('feature/aggregation/lite/gettext.php',f);
res.onload = function(){
text = res.responseText;

layerURL(text);

for(var a=0;a<layer_urls.length;a++){

   getUrlText(layer_urls[a]);
   
   fetch_product(layer_urls[a],text);
}
};

return text;
}

</script>
</body>
</html>
