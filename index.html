<html>
<head>
<title>Aggregator Lite</title>
 <link rel=stylesheet href=https://productlists.co.za/style.css />
</head>
<body>
<script src=api.js ></script>
<script src=product.js ></script>
<h3>Target Website</h3>
<span>URL</span>
<input type=text name=url id=url />
<a href=# onclick="getUrlText(e('url').value);e('log').innerHTML='';layer_urls=[];" >START</a>
<a href=# onclick="stop=true;" >STOP</a>
 <br><br>
<span>INDEX</span>
<input type=number name=index id=index />
<a href=# onclick="ind=parseInt(e('index').value);" >SET_INDEX</a>
<br><br>
 <fieldset>
<legend>Parameters</legend>
<div id=parameters ></div>
<a href=# onclick="addPP();return false;"  style="float:right;" >add_field</a>
</fieldset>

<script>

var field_names = ['heading','price','description','comments','images'];
var index = ['-1','-1','0-2','-1','7-10'];
var tags = ['<span,<h','<span,<div','<div,<p','<div,<p','<img'];
var indicators = ['title,name,heading,pp_spd','price,cost,pp_mFOB','description,pp_secRow','review,comment','src'];
var size = [20,2,200,200,70];

for(var a=0;a<field_names.length;a++){
addPP(field_names[a],index[a],tags[a],indicators[a],size[a]);
}


function addPP(field_name,index,tags,indicators,size){

e('parameters').innerHTML += 

'<div class=field style="padding:20px;" >'+
'<a href=# onclick=this.parentNode.remove(); style="float:right;" >XX</a>'+
'field_name<input type=text value="'+(field_name?field_name:'')+'" /><br>'+
'index<input type=text value="'+(index?index:'')+'" /><br>'+
'tags<input type=text value="'+(tags?tags:'')+'" /><br>'+
'indicators<input type=text value="'+(indicators?indicators:'')+'" /><br>'+
'size<input type=number value="'+(size?size:'')+'" /><br>'+
'long<input type=checkbox /><br>'+
'</div>';

}


</script>
<br><br>
<strong>LOG</strong>
<div style="border:2px solid red;padding:10px;"  id=log ></div>
<script>
var external_urls = [];

var layer_urls = [];

function layerURL(text){

var links = text.split('<a ');

for(var a=0;a<links.length;a++){

var narrow = links[a].substring(0,400);
 
 var begin = narrow.indexOf('href="')+6;

var hh = narrow.substring(begin,narrow.indexOf('"',begin));
 
 // e('log').innerHTML += '('+hh+') link<br>';
   
  if(layer_urls.indexOf(hh)==-1 && external_urls.indexOf(hh)==-1){
if(hh.includes(e('url').value)){
layer_urls[layer_urls.length] = hh;
}else if(hh.indexOf('/')==0){
 
layer_urls[layer_urls.length] = e('url').value+hh; 
}else{
external_urls[external_urls.length] = hh;
}
    }
 
}

}

 var stop = false;
 var ind = 0;
 
function getUrlText(url){

var f = new FormData();
f.append('URL',url);

var res = sendform_2('feature/aggregation/lite/gettext.php',f);
res.onload = function(){
var text = res.responseText;
  
 layerURL(text);
 
 e('log').innerHTML += '('+ind+') index<br>';
 
 e('log').innerHTML += '('+layer_urls.length+') links<br>';
 
 e('log').innerHTML += '('+external_urls.length+') exit links<br>';
 
if(!stop && ind<layer_urls.length){

 fetch_product(layer_urls[ind],text);
 ind+=1;
 
 getUrlText(layer_urls[ind]);
 
 
   }
};
}
</script>
</body>
</html>
